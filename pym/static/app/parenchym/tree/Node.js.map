{"version":3,"sources":["parenchym/tree/Node.js"],"names":[],"mappings":"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","file":"parenchym/tree/Node.js","sourcesContent":["import angular from 'angular';\n\n\nfunction dataToNodes(tree, data) {\n    let nn = [];\n    for (let d of data) {\n        let n = new Node(tree, d);\n        nn.push(n);\n        if (d.children) {\n            n.setChildNodes(dataToNodes(tree, d.children));\n        }\n    }\n    return nn;\n}\n\n\nclass Node {\n    constructor (tree, nodeData) {\n        this.tree = tree;\n        this.data = nodeData;\n        this._id = undefined;\n        this._type = undefined;\n        this._children = undefined;\n        this._filteredChildren = [];\n        this._parent = undefined;\n\n        this.expanded = nodeData.expanded ? nodeData.expanded : false;\n        this.selected = nodeData.selected ? nodeData.selected : false;\n\n        this.tree.allNodes.set(this.id, this);\n    }\n\n    /**\n     * Node ID that is unique in the whole tree.\n     * \n     * This node ID may be provided in the data as key '__nodeID__'. If not,\n     * we construct it ourselves by concatenating the node type and the ID from\n     * the data (keys '__type__' and 'id'). If '__nodeType__' is not given,\n     * we consider key 'id' to be the node ID. If both keys are absent, we use\n     * an integer sequence.\n     *\n     * Using key 'id' as the node ID may not what you want, e.g. if the\n     * different levels of the tree come from different database tables. Then\n     * the same 'id' may occur multiple times, on different levels, true, but\n     * angular's 'track by' will still complain verbosely.\n     */\n    get id() {\n        if (this._id === undefined) {\n            // Node ID is provided\n            this._id = this.data.__nodeId__;\n            if (this._id === undefined) {\n                // Not provided, so construct it ourselves\n                this._id = this.tree.idGen(this);\n            }\n            this._id = '' + this._id;\n        }\n        return this._id;\n    }\n\n    get type() {\n        if (this._type === undefined) {\n            this._type = this.data.__type__;\n        }\n        return this._type;\n    }\n\n    get text() {\n        if (angular.isFunction(this.data.text)) {\n            return this.data.text(this.data);\n        }\n        else {\n            return this.data.text;\n        }\n    }\n\n    get hasChildren() {\n        return this._filteredChildren.length > 0;\n    }\n\n    get children() {\n        return this._filteredChildren;\n    }\n\n    get parent() {\n        return this._parent;\n    }\n\n    expand(recursive=false, maxDepth=99999) {\n        let self = this;\n        let _doExpand = function () {\n            if (self.hasChildren) {\n                let allow = self.tree.rc.onExpand\n                    ? self.tree.rc.onExpand(self.tree, self)\n                    : true;\n                if (allow) {\n                    self.expanded = true;\n                    self.tree.expanded.add(self);\n                }\n                if (recursive && maxDepth > 0) {\n                    for (let ch of self.children) {\n                        ch.expand(recursive, maxDepth-1);\n                    }\n                }\n            }\n        };\n\n        if (this.tree.rc.onLoadChildren && ! angular.isArray(this._children)) {\n            this.tree.rc.onLoadChildren(this.tree, this)\n                .then(childrenData => {\n                    this.setChildNodes(dataToNodes(this.tree, childrenData));\n                    _doExpand();\n                });\n        }\n        else {\n            _doExpand();\n        }\n    }\n\n    collapse(recursive=false) {\n        let allow = this.tree.rc.onCollapse\n            ? this.tree.rc.onCollapse(this.tree, this)\n            : true;\n        if (allow) {\n            this.expanded = false;\n            this.tree.expanded.delete(this);\n        }\n        if (recursive && this.hasChildren) {\n            for (let ch of this.children) { ch.collapse(recursive); }\n        }\n    }\n\n    toggle(recursive=false) {\n        if (this.expanded) {\n            this.collapse(recursive);\n        }\n        else {\n            this.expand(recursive);\n        }\n    }\n\n    select(recursive=false) {\n        let allow = this.tree.rc.onSelect\n            ? this.tree.rc.onSelect(this.tree, this)\n            : true;\n        if (allow) {\n            this.selected = true;\n            if (! this.tree.rc.multiSelect) {\n                for (let n of this.tree.selected) {\n                    n.unselect(false);\n                }\n            }\n            this.tree.selected.add(this);\n        }\n        if (recursive && this.hasChildren) {\n            for (let ch of this.children) { ch.select(recursive); }\n        }\n        // If recursive, let caller call tree.selectedToList()\n        if (! recursive) {\n            this.tree.selectedToList();\n        }\n    }\n\n    unselect(recursive=false) {\n        let allow = this.tree.rc.onUnselect\n            ? this.tree.rc.onUnselect(this.tree, this)\n            : true;\n        if (allow) {\n            this.selected = false;\n            this.tree.selected.delete(this);\n        }\n        if (recursive && this.hasChildren) {\n            for (let ch of this.children) { ch.unselect(recursive); }\n        }\n        // If recursive, let caller call tree.selectedToList()\n        if (! recursive) {\n            this.tree.selectedToList();\n        }\n    }\n\n    toggleSelection(recursive=false) {\n        if (this.selected) {\n            this.unselect(recursive);\n        }\n        else {\n            this.select(recursive);\n        }\n    }\n\n    expandCollapseButton() {\n        if (this.expanded) {\n            return this.tree.rc.collapseButton;\n        }\n        if (this.hasChildren === undefined) {\n            return this.tree.rc.mayExpandButton;\n        }\n        if (this.hasChildren) {\n            return this.tree.rc.expandButton;\n        }\n        return this.tree.rc.blankButton;\n    }\n\n    filterChildren() {\n        this._filteredChildren.length = 0;\n        if (this._children) {\n            if (this.tree.matches === null) {\n                for (let node of this._children) {\n                    this._filteredChildren.push(node);\n                    node.filterChildren();\n                }\n            }\n            else {\n                for (let node of this._children) {\n                    if (this.tree.matches.has(node)) {\n                        this._filteredChildren.push(node);\n                    }\n                    node.filterChildren();\n                }\n            }\n        }\n    }\n\n    setChildNodes(children) {\n        this._children = children;\n        for (let ch of children) {\n            ch.setParentNode(this);\n        }\n    }\n\n    setParentNode(n) {\n        this._parent = n;\n    }\n}\n\n\nexport { Node, dataToNodes };\n"],"sourceRoot":"/source/"}