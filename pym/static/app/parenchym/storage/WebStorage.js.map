{"version":3,"sources":["parenchym/storage/WebStorage.js"],"names":[],"mappings":"AAAA;;AAEA,OAAO,eAAe,SAAS,cAAc;IACzC,OAAO;;;AAGX,IAAI,eAAe,YAAY,EAAE,SAAS,iBAAiB,QAAQ,OAAO,EAAE,KAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK,EAAE,IAAI,aAAa,MAAM,IAAI,WAAW,aAAa,WAAW,cAAc,OAAO,WAAW,eAAe,MAAM,IAAI,WAAW,YAAY,WAAW,WAAW,MAAM,OAAO,eAAe,QAAQ,WAAW,KAAK,iBAAiB,OAAO,UAAU,aAAa,YAAY,aAAa,EAAE,IAAI,YAAY,iBAAiB,YAAY,WAAW,aAAa,IAAI,aAAa,iBAAiB,aAAa,cAAc,OAAO;;AAEhiB,SAAS,gBAAgB,UAAU,aAAa,EAAE,IAAI,EAAE,oBAAoB,cAAc,EAAE,MAAM,IAAI,UAAU;;AAEhH,IAVM,aAAA,YAAA;IAEF,SAFE,WAEU,aAAa,IAAI,SAAS;QAUlC,gBAAgB,MAZlB;;QAGE,KAAK,eAAe;QACpB,KAAK,MAAM;QACX,KAAK,WAAW;;QAEhB,KAAK,SAAS;;QAEd,KAAK;QACL,KAAK,WAAW,QAAQ;;;IAc5B,aAxBE,YAAA,CAAA;QAyBE,KAAK;QACL,OAAO,SAAS,IAbhB,KAAK;YACL,OAAO,KAAK,SAAS,QAAQ,KAAK,UAAU;;OAe7C;QACC,KAAK;QACL,OAAO,SAAS,UAdV,KAAK;YACX,IAAI,IAAI,KAAK,IAAI;YACjB,OAAO,KAAK,IAAI,WAAW,MAAM;;OAgBlC;QACC,KAAK;QACL,OAAO,SAAS,IAfhB,KAAK,GAAG;YACR,KAAK,SAAS,QAAQ,KAAK,UAAU,MAAM;;OAiB5C;QACC,KAAK;QACL,OAAO,SAAS,UAhBV,KAAK,GAAG;YACd,IAAI,IAAI,KAAK,IAAI,WAAW,UAAU;YACtC,KAAK,IAAI,KAAK;;OAkBf;QACC,KAAK;QACL,OAAO,SAAS,OAjBb,KAAK;YACR,KAAK,SAAS,OAAO,KAAK,UAAU;;OAmBrC;QACC,KAAK;QACL,OAAO,SAAS,QAlBZ;YACJ,KAAK,SAAS;;OAoBf;QACC,KAAK;QACL,OAAO,SAAS,SAnBX;YACL,OAAO,KAAK,SAAS;;OAqBtB;QACC,KAAK;QACL,OAAO,SAAS,UApBV,KAAK;YACX,IAAI,KAAK;YACT,IAAI,KAAK,QAAQ;gBACb,GAAG,KAAK,KAAK;;YAEjB,IAAI,KAAK,IAAI,SAAS;gBAClB,GAAG,KAAK,KAAK,IAAI;;YAErB,GAAG,KAAK;YACR,IAAI,KAAK,IAAI,QAAQ;gBACjB,GAAG,KAAK,KAAK,IAAI;;YAErB,OAAO,GAAG,KAAK,KAAK,IAAI;;OAsBzB;QACC,KAAK;QACL,OAAO,SAAS,uBArBG;YACnB,IAAI,YAAA;;;;;;;;;;YADe,IAWf;gBACA,YAAY,KAAK,SAAS,KAAK;cAEnC,OAAO,KAAK;gBACR,YAAY;;;;;;YAfG,IAqBf,aAAa,KAAK,iBAAiB,gBAAgB;gBACnD,IAAI,MAAM,OAAO,KAAK,MAAM,KAAK,WAAW;;gBAE5C,IAAI;oBACA,aAAa,QAAQ,KAAK;oBAC1B,aAAa,WAAW;kBAE5B,OAAO,KAAK;oBACR,YAAY;;;YAGpB,IAAI,CAAE,WAAW;gBACb,MAAM,IAAI,MAAJ,eAAsB,KAAK,eAAL;;;;;IAwBpC,OAnHE;;;AAsHN,QArBS,aAAA,WAAA","file":"parenchym/storage/WebStorage.js","sourcesContent":["class WebStorage {\n\n    constructor(storageType, rc, $window) {\n        this._storageType = storageType;\n        this._rc = rc;\n        this._$window = $window;\n\n        this.prefix = 'pym';\n\n        this._checkBrowserSupport();\n        this._storage = $window[storageType];\n    }\n\n    get(key) {\n        return this._storage.getItem(this._buildKey(key));\n    }\n\n    getObject(key) {\n        let v = this.get(key);\n        return this._rc.serializer.parse(v);\n    }\n\n    set(key, v) {\n        this._storage.setItem(this._buildKey(key), v);\n    }\n\n    setObject(key, o) {\n        let v = this._rc.serializer.stringify(o);\n        this.set(key, v);\n    }\n\n    remove(key) {\n        this._storage.remove(this._buildKey(key));\n    }\n\n    clear() {\n        this._storage.clear();\n    }\n\n    length() {\n        return this._storage.length;\n    }\n\n    _buildKey(key) {\n        let kk = [];\n        if (this.prefix) {\n            kk.push(this.prefix);\n        }\n        if (this._rc.usePath) {\n            kk.push(this._rc.path);\n        }\n        kk.push(key);\n        if (this._rc.useUid) {\n            kk.push(this._rc.uid);\n        }\n        return kk.join(this._rc.sep);\n    }\n\n    _checkBrowserSupport() {\n        let supported;\n\n        // Lifted from: https://github.com/gsklee/ngStorage/blob/master/ngStorage.js\n\n        // Some installations of IE, for an unknown reason, throw \"SCRIPT5: Error: Access is denied\"\n        // when accessing window.webStorage. This happens before you try to do anything with it. Catch\n        // that error and allow execution to continue.\n\n        // fix 'SecurityError: DOM Exception 18' exception in Desktop Safari, Mobile Safari\n        // when \"Block cookies\": \"Always block\" is turned on\n        try {\n            supported = this._$window[this._storageType];\n        }\n        catch (err) {\n            supported = false;\n        }\n\n        // When Safari (OS X or iOS) is in private browsing mode, it appears as though localStorage\n        // is available, but trying to call .setItem throws an exception below:\n        // \"QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to add something to storage that exceeded the quota.\"\n        if (supported && this._storageType === 'localStorage') {\n            var key = '__' + Math.round(Math.random() * 1e7);\n\n            try {\n                localStorage.setItem(key, key);\n                localStorage.removeItem(key);\n            }\n            catch (err) {\n                supported = false;\n            }\n        }\n        if (! supported) {\n            throw new Error(`Storage '${this._storageType}' is not supported in this browser.`);\n        }\n    }\n}\n\n\nexport { WebStorage };\n"],"sourceRoot":"/source/"}